{% extends "base.html" %}

{% block title %}{{ investment.name }}{% endblock %}
{% block header_title %}{{ investment.name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <a href="{{ url_for('investments_list') }}" class="text-secondary" style="font-size: 0.875rem;">‚Üê Volver a
            Inversiones</a>
        <h2 style="margin-top: 0.5rem;">{{ investment.name }}</h2>
    </div>
    <a href="{{ url_for('investment_edit', investment_id=investment.id) }}" class="btn btn-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Editar
    </a>
</div>

<div class="grid-2">
    <!-- Investment Details Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Detalles de la Inversi√≥n</h3>
            <span
                class="badge badge-{% if investment.status == 'active' %}success{% elif investment.status == 'completed' %}primary{% else %}danger{% endif %}">
                {{ investment.status|title }}
            </span>
        </div>
        <div class="card-body">
            <div class="investment-card" style="box-shadow: none; margin-bottom: 1.5rem;">
                <div class="investment-type-bar {{ investment.investment_type }}"></div>
                <div class="investment-body" style="text-align: center; padding: 2rem;">
                    <span
                        class="badge badge-{% if investment.investment_type == 'plazo_fijo' %}success{% elif investment.investment_type == 'bono' %}warning{% else %}info{% endif %} mb-2">
                        {{ investment.investment_type|replace('_', ' ')|title }}
                    </span>
                    <div class="investment-amount">
                        {{ investment.currency }} {{ "{:,.0f}".format(investment.amount) }}
                    </div>
                    {% if investment.interest_rate %}
                    <p class="text-secondary">Tasa: {{ investment.interest_rate }}% anual</p>
                    {% endif %}
                </div>
            </div>

            <div class="grid-2" style="gap: 1rem;">
                {% if investment.broker_rel %}
                <div>
                    <strong class="text-muted" style="font-size: 0.75rem; text-transform: uppercase;">Broker</strong>
                    <p><a href="{{ url_for('broker_detail', broker_id=investment.broker_rel.id) }}">{{
                            investment.broker_rel.name }}</a></p>
                </div>
                {% endif %}

                <div>
                    <strong class="text-muted" style="font-size: 0.75rem; text-transform: uppercase;">Creado
                        por</strong>
                    <p>{{ investment.creator.full_name or investment.creator.username }}</p>
                </div>

                {% if investment.start_date %}
                <div>
                    <strong class="text-muted" style="font-size: 0.75rem; text-transform: uppercase;">Fecha de
                        Inicio</strong>
                    <p>{{ investment.start_date.strftime('%d/%m/%Y') }}</p>
                </div>
                {% endif %}

                {% if investment.end_date %}
                <div>
                    <strong class="text-muted" style="font-size: 0.75rem; text-transform: uppercase;">Fecha de
                        Vencimiento</strong>
                    <p>{{ investment.end_date.strftime('%d/%m/%Y') }}</p>
                </div>
                {% endif %}
            </div>

            {% if investment.notes %}
            <div class="mt-3">
                <strong class="text-muted" style="font-size: 0.75rem; text-transform: uppercase;">Notas</strong>
                <p>{{ investment.notes }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Calculation Card (for Plazo Fijo) -->
    {% if investment.investment_type == 'plazo_fijo' and investment.interest_rate %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üìä C√°lculo de Rendimiento</h3>
        </div>
        <div class="card-body">
            <div class="stat-card success" style="margin-bottom: 1rem;">
                <div class="stat-icon success">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <polyline points="22,7 13.5,15.5 8.5,10.5 2,17"></polyline>
                        <polyline points="16,7 22,7 22,13"></polyline>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Inter√©s Estimado</div>
                    <div class="stat-value text-success">+{{ investment.currency }} {{
                        "{:,.0f}".format(investment.calculated_return) }}</div>
                </div>
            </div>

            <div class="stat-card" style="margin-bottom: 1rem;">
                <div class="stat-icon primary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Total al Vencimiento</div>
                    <div class="stat-value">{{ investment.currency }} {{ "{:,.0f}".format(investment.total_at_maturity)
                        }}</div>
                </div>
            </div>

            {% if investment.start_date and investment.end_date %}
            <div class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12,6 12,12 16,14"></polyline>
                </svg>
                Duraci√≥n: {{ (investment.end_date - investment.start_date).days }} d√≠as
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <!-- Empty placeholder for non-plazo fijo -->
    <div></div>
    {% endif %}
</div>

<!-- Messages Section -->
<div class="card mt-3">
    <div class="card-header">
        <h3 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2"
                style="display: inline; margin-right: 8px; vertical-align: middle;">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            Comentarios de la Inversi√≥n
        </h3>
    </div>
    <div class="card-body">
        <!-- Add Message Form -->
        <form method="POST" action="{{ url_for('investment_message', investment_id=investment.id) }}" class="mb-3">
            <div class="form-group mb-2">
                <textarea class="form-control" name="content"
                    placeholder="Escribe un comentario sobre esta inversi√≥n..." rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                </svg>
                Enviar Comentario
            </button>
        </form>

        <!-- Messages List -->
        {% if messages %}
        <div class="message-list">
            {% for msg in messages %}
            <div class="message-item">
                <div class="message-avatar">{{ msg.author.full_name[0] if msg.author.full_name else
                    msg.author.username[0]|upper }}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author">{{ msg.author.full_name or msg.author.username }}</span>
                        <span class="message-time">{{ msg.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
                    </div>
                    <p class="message-text">{{ msg.content }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state" style="padding: 2rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.5">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <h3>Sin comentarios</h3>
            <p>S√© el primero en dejar un comentario sobre esta inversi√≥n</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}